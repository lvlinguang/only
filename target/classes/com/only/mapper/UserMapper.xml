<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.only.mapper.UserMapper">

	<!-- 添加用户 -->
	<insert id="addUser" useGeneratedKeys="true" keyProperty="id">
		insert
		into User(Name,Account,Password,Mobile,Salt)
		values(#{name},#{account},#{password},#{mobile},#{salt})
	</insert>

	<!-- 修改用户 -->
	<update id="updateUser" parameterType="com.only.model.User">
		update User
		<set>
			<if test="name!=null and name!=''">Name=#{name},</if>
			<if test="account!=null and account!=''">Account=#{account},</if>
			<if test="mobile!=null and mobile!=''">Mobile=#{mobile},</if>
			<if test="updatedate!=null and updatedate!=''">UpdateDate=#{updatedate},</if>
			<if test="salt!=null and salt!=''">Salt=#{salt},</if>
			<if test="password!=null and password!=''">PassWord=#{password},</if>
			<if test="lastlogondate!=null and lastlogondate!=''">LastLogonDate=#{lastlogondate}</if>
		</set>
		where ID=#{id}
	</update>

	<!-- 删除用户 -->
	<update id="deleteUser" parameterType="int">
		update User set Enable=0
		where ID=#{id}
	</update>

	<!-- 根据id得到数据 -->
	<select id="getUserByID" parameterType="int" resultType="com.only.model.User">
		select *
		from User
		Where
		ID=#{id}
	</select>

	<!-- 根据帐号得到数据 -->
	<select id="getUserByAccount" resultType="com.only.model.User">
		select * from User
		Where Account=#{account} limit 1
	</select>

	<!-- 用户列表条数 -->
	<select id="getUserListTotal" resultType="int">
		SELECT
		count(0)
		from User AS u1
		left join
		UserRole AS
		u2 on u1.ID=u2.UserID
		left join Role AS r on u2.RoleID=r.ID
		where
		u1.enable=1
		<if test="roleid!=null and roleid!=0">
			and r.ID=#{roleid}
		</if>
		<if test="name!=null and name !=''">
			and u1.Name like concat('%',#{name},'%')
		</if>
	</select>

	<!-- 用户列表 -->
	<select id="getUserList" resultType="com.only.model.UserCustom">
		SELECT
		u1.ID,
		u1.Name,
		u1.Account,
		u1.Password,
		u1.Salt,
		u1.Mobile,
		u1.QQ,
		u1.Email,
		u1.CreateDate,
		r.Name AS rolename
		from User AS u1
		left join
		UserRole AS
		u2 on u1.ID=u2.UserID
		left join Role AS r on u2.RoleID=r.ID
		where
		u1.enable=1
		<if test="roleid!=null and roleid!=0">
			and r.ID=#{roleid}
		</if>
		<if test="name!=null and name !=''">
			and u1.Name like concat('%',#{name},'%')
		</if>
		<if test="page!=null">
			<if test="page.sort!=null and page.sort!=''">
				order by concat('u1.',#{page.sort}) #{page.order}
			</if>
			<if test="page.pageIndex>0">
				limit #{page.start},#{page.end}
			</if>
		</if>
	</select>

</mapper>